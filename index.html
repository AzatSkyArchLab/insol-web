<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insol Web ‚Äî –†–∞—Å—á—ë—Ç –∏–Ω—Å–æ–ª—è—Ü–∏–∏</title>
    
    <link rel="stylesheet" href="css/main.css">
    <link href="https://unpkg.com/maplibre-gl@4.5.0/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://unpkg.com/maplibre-gl@4.5.0/dist/maplibre-gl.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/earcut@2.2.4/dist/earcut.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/osmtogeojson@3.0.0-beta.5/osmtogeojson.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>

<body>
    <!-- –†–µ–∂–∏–º 1: –ö–∞—Ä—Ç–∞ -->
    <div id="map-mode">
        <div id="map"></div>
        
        <div id="info-panel">
            <h3>Insol Web</h3>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ –æ–±–ª–∞—Å—Ç—å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</p>
            <button id="select-mode-btn">–í—ã–±—Ä–∞—Ç—å –æ–±–ª–∞—Å—Ç—å</button>
            <div id="selection-info"></div>
            <button id="load-btn" disabled>–ó–∞–≥—Ä—É–∑–∏—Ç—å –æ–±–ª–∞—Å—Ç—å</button>
        </div>
    </div>
    
    <!-- –†–µ–∂–∏–º 2: 3D-—Å—Ü–µ–Ω–∞ -->
    <div id="scene-mode" class="hidden">
        <div id="scene-container"></div>
        
        <div id="scene-panel">
            <h3>3D –ú–æ–¥–µ–ª—å</h3>
            <p>–ó–¥–∞–Ω–∏–π: <span id="building-count">0</span></p>
            
            <div class="legend">
                <div class="legend-item">
                    <span class="legend-color residential"></span>
                    –ñ–∏–ª—ã–µ
                </div>
                <div class="legend-item">
                    <span class="legend-color other"></span>
                    –ü—Ä–æ—á–∏–µ
                </div>
            </div>
            
            <button id="back-btn">–ù–∞–∑–∞–¥ –∫ –∫–∞—Ä—Ç–µ</button>
        </div>
        
        <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –∑–¥–∞–Ω–∏—è -->
        <div id="building-card" class="hidden">
            <div class="card-header">
                <span id="card-title">–ó–¥–∞–Ω–∏–µ</span>
                <button id="card-close">‚úï</button>
            </div>

            <div class="card-content">
                <div class="card-row">
                    <span class="card-label">–¢–∏–ø:</span>
                    <div class="card-toggle">
                        <button class="toggle-btn active" data-residential="true">–ñ–∏–ª–æ–µ</button>
                        <button class="toggle-btn" data-residential="false">–ù–µ–∂–∏–ª–æ–µ</button>
                    </div>
                </div>
                <div class="card-row">
                    <span class="card-label">–§—É–Ω–∫—Ü–∏—è:</span>
                    <span id="card-function">‚Äî</span>
                </div>
                <div class="card-row">
                    <span class="card-label">–≠—Ç–∞–∂–µ–π:</span>
                    <span id="card-levels">‚Äî</span>
                </div>
                <div class="card-row">
                    <span class="card-label">–í—ã—Å–æ—Ç–∞:</span>
                    <span id="card-height">‚Äî</span>
                </div>
                <div class="card-row">
                    <span class="card-label">–ò—Å—Ç–æ—á–Ω–∏–∫:</span>
                    <span id="card-height-source">‚Äî</span>
                </div>
                <div class="card-row">
                    <span class="card-label">–ê–¥—Ä–µ—Å:</span>
                    <span id="card-address">‚Äî</span>
                </div>
                <div class="card-row">
                    <span class="card-label">OSM ID:</span>
                    <span id="card-osm-id">‚Äî</span>
                </div>
            </div>
            
            <div class="card-actions">
                <button id="edit-height-btn">üìê –ò–∑–º–µ–Ω–∏—Ç—å –≤—ã—Å–æ—Ç—É</button>
                <button id="insolation-grid-btn">‚òÄÔ∏è –ò–Ω—Å–æ–ª—è—Ü–∏–æ–Ω–Ω–∞—è —Å–µ—Ç–∫–∞</button>
                <button id="select-all-points-btn" class="hidden">‚úì –í—ã–±—Ä–∞—Ç—å –≤—Å–µ —Ç–æ—á–∫–∏</button>
                <button id="calculate-insolation-btn" class="hidden">üî¨ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∏–Ω—Å–æ–ª—è—Ü–∏—é</button>
            </div>
        </div>
        <!-- –ö–æ–Ω–µ—Ü –∫–∞—Ä—Ç–æ—á–∫–∏ –∑–¥–∞–Ω–∏—è -->
        

        <!-- –ü–∞–Ω–µ–ª—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–Ω—Å–æ–ª—è—Ü–∏–∏ (–≤—ã–¥–≤–∏–∂–Ω–∞—è) -->
        <div id="insolation-results" class="hidden">
            <div class="panel-header">
                <span>‚òÄÔ∏è –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–Ω—Å–æ–ª—è—Ü–∏–∏</span>
                <button id="insolation-results-close" title="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
            </div>
            <div class="panel-content">
                <div class="result-stats">
                    <div class="stat pass">
                        <span id="stat-pass">0</span>
                        <small>–ù–æ—Ä–º–∞</small>
                    </div>
                    <div class="stat warning">
                        <span id="stat-warning">0</span>
                        <small>–ö–≤–∞—Ä—Ç–∏—Ä.</small>
                    </div>
                    <div class="stat fail">
                        <span id="stat-fail">0</span>
                        <small>–ù–µ —Å–æ–æ—Ç–≤.</small>
                    </div>
                </div>
                
                <div class="result-controls">
                    <button id="toggle-rays-btn">üîÜ –õ—É—á–∏ —Ç–æ—á–∫–∏</button>
                    <button id="toggle-all-rays-btn">üåû –í—Å–µ –ª—É—á–∏</button>
                </div>
                
                <div class="results-list-header">
                    –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—á–∫—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª—É—á–µ–π:
                </div>
                
                <div id="insolation-details"></div>
            </div>
        </div>
        <!-- –ö–æ–Ω–µ—Ü –ø–∞–Ω–µ–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
        
    </div>
    <!-- –ö–æ–Ω–µ—Ü scene-mode -->
    
    <script type="module" src="js/main.js"></script>
</body>
</html>